pragma solidity ^0.4.24;

import 'zeppelin-solidity/contracts/ownership/Ownable.sol';
import 'zeppelin-solidity/contracts/math/SafeMath.sol';

contract Odds is Ownable {
  using SafeMath for uint256;

  uint256 public consecutiveWins;
  uint256 public numWins;
  uint256 public numLosses;
  uint256 public lastHash;
  uint256 private factor = 578960446186580977117854925043439539266349923328202820197;

  /// @dev Deploy contract and set initial values to zero
  constructor()
    public
  {
    consecutiveWins = 0;
    numWins = 0;
  }

  // @dev Flip a coin. A winner gets 2x their contribution.
  // @param _guess The player's guess
  function flip(bool _guess)
    payable
    returns (bool)
  {
    uint256 betValue = msg.value;
    require(betValue.mul(2) <= address(this).balance);
    uint256 blockValue = uint256(block.blockhash(block.number-1));

    if (lastHash == blockValue) {
      revert();
    }

    lastHash = blockValue;
    uint256 coinFlip = blockValue / factor;
    bool side = coinFlip == 1 ? true : false;

    if (side == _guess) {
      consecutiveWins++;
      numWins += 1;
      msg.sender.transfer(betValue.mul(2));
      return true;
    } else {
      consecutiveWins = 0;
      numWins -= 1;
      return false;
    }
  }

  function withdrawFunds()
    public
    onlyOwner
  {
    owner().transfer(msg.value);
    ForwardETH(msg.sender, msg.value);
  }
}
